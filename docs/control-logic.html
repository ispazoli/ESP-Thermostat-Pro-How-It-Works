<!doctype html>
<html lang="hu">
<head>
<meta charset="utf-8">
<title>Vezérlési logika</title>
<link rel="stylesheet" href="style.css">
</head>
<body>

<header>
  <div class="container">
    <h1>ESP Thermostat Pro – Működési elv</h1>
    <div class="badges">
      <span class="badge">Statikus dokumentáció</span>
      <span class="badge">Kétvezérlős architektúra</span>
      <span class="badge">Nincs kötelező felhő</span>
    </div>
    <nav>
      <a href="index.html">Kezdőlap</a>
      <a href="architecture.html">Architektúra</a>
      <a href="control-logic.html">Vezérlés</a>
      <a href="learning.html">Tanulás</a>
      <a href="safety.html">Biztonság</a>
      <a href="gas-energy.html">Gáz & Energia</a>
      <a href="ui-themes.html">Felületek</a>
      <a href="diagnostics.html">Diagnosztika</a>
      <a href="setup.html">Telepítés</a>
    </nav>
  </div>
</header>

<main class="container">
  <h2>Vezérlési logika</h2>

  <div class="card">
    <p>
      Itt a termosztát <b>döntési folyamatát</b> magyarázzuk el: <b>Auto / Kézi</b> mód, ütemezés,
      <b>Előfűtés (Pre‑Heat)</b>, <b>Távollét (Away)</b> és <b>Haladó ütemezés</b>.
      A cél: érthető legyen, <b>mikor miért indul / áll le</b> a fűtés.
    </p>
    <p class="small" style="color:var(--muted)">
      Fontos: ez az oldal a valós vezérlési viselkedést írja le, de továbbra is <b>dokumentáció</b>.
      A GitHub Pages bemutató nem tartalmaz vezérlőgombokat és nem fut benne folyamatos lekérdezés (polling).
    </p>
  </div>

  <h3>Auto mód</h3>
  <div class="card">
    <p>
      Auto módban a célhőmérsékletet az ütemezés adja (hétköznap / hétvége), vagy – ha engedélyezve van – a
      <b>Haladó ütemezés</b>. A kapcsolgatás elkerülésére a vezérlés <b>hiszterézist</b> használ.
    </p>

    <h3>Célhőmérséklet kiválasztása Auto módban</h3>
    <ol>
      <li><b>Ha a Haladó ütemezés aktív</b>, a rendszer a legutóbbi, időben már „elmúlt” és engedélyezett pont célértékét használja.</li>
      <li>Ha nincs Haladó ütemezés, akkor a <b>Hétköznap / Hétvége</b> blokk (reggel/este) célértékei érvényesek.</li>
      <li><b>Ha Távollét (Away) aktív</b>, a célértéket felülírja az Away célhőmérséklet (lásd lent).</li>
      <li><b>Ha LoS / Fallback aktív</b> (szenzorhiba), a célértéket és/vagy a ciklikus Safe‑Heat működést a fallback szabályok írják felül.</li>
    </ol>
  </div>

  <h3>Kézi mód (Kézi)</h3>
  <div class="card">
    <p>
      Kézi módban a célhőmérsékletet a felhasználó állítja be. Ilyenkor a termosztát nem az ütemezésből számol,
      hanem a fix célértéket tartja – a <b>biztonsági korlátok</b> (pl. LoS fallback) továbbra is érvényesek.
    </p>
  </div>

  <h3>Relé döntés hiszterézissel</h3>
  <div class="card">
    <p>
      A hiszterézis célja, hogy a relé ne „ciceregjen” (ne kapcsolgasson gyorsan ki‑be).
      A logika leegyszerűsítve:
    </p>
    <ul>
      <li><b>Fűtés BE</b>, ha a mért hőmérséklet kisebb, mint <b>(cél − hiszterézis)</b>.</li>
      <li><b>Fűtés KI</b>, ha a mért hőmérséklet eléri vagy meghaladja a <b>célt</b> (vagy a hiszterézis tartományban stabilizálódik a beállítás szerint).</li>
    </ul>
    <p>
      Ez stabilabb szabályozást ad, és kíméli a relét/kazánt a túl sűrű kapcsolástól.
    </p>
  </div>

  <h3>Előfűtés (Pre‑Heat)</h3>
  <div class="card">
    <p>
      Előfűtésnél a rendszer a korábbi felfűtési tapasztalatok alapján megpróbálja
      <b>korábban elindítani</b> a fűtést, hogy a beütemezett időpontra a hőmérséklet már a cél közelében legyen.
    </p>
    <p>
      Tipikusan: ha reggel 06:00‑ra 21&nbsp;°C a cél, a termosztát nem 06:00‑kor kezd fűteni,
      hanem annyival előbb, amennyit a tanult felfűtési sebesség indokol.
    </p>
  </div>

  <h3>Távollét (Away) mód</h3>
  <div class="card">
    <p>
      Away módban a célhőmérsékletet egy alacsonyabb, takarékos érték váltja fel (pl. 18&nbsp;°C).
      Aktiválódhat <b>manuálisan</b>, vagy <b>jelenlét‑érzékelés</b> alapján (figyelt IP‑k pingelése, időtúllépéssel).
    </p>
    <p>
      Amint a rendszer újra „látja” a megadott eszközöket (vagy manuálisan kikapcsolod), visszaáll a normál célérték (ütemezés / haladó ütemezés).
    </p>
  </div>

  <h3>Haladó ütemezés</h3>
  <div class="card">
    <p>
      A Haladó ütemezés (7 napos) lehetővé teszi, hogy naponta több, pontos időponthoz kötött célértéket adj meg.
      A termosztát mindig a <b>legutóbbi múltbeli</b> ütempontot tekinti aktívnak.
    </p>
    <p>
      Ez rugalmasabb, mint a „hétköznap/hétvége reggel/este” logika, és alkalmas összetettebb rutinokra.
    </p>
  </div>

  <div class="figure">
    <img src="assets/screenshots/System2.jpg" alt="Vezérlés és státusz képernyő">
    <div class="figcap">Példa: vezérlési állapotok és program-információk a felületen</div>
  </div>
</main>

<footer>
  <div class="container">
    Ez az oldal GitHub Pages-en futó, <b>statikus dokumentáció</b>.
    Az éles vezérlőfelület és logika az ESP32 eszközön működik.
  </div>
</footer>

</body>
</html>
